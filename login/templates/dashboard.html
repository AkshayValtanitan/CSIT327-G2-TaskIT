{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Calendar</title>
    <link rel="stylesheet" href="{% static 'login/css/dashboard.css' %}?v={% now 'U' %}">
</head>
<body>
    <div class="sidebar">
        <h2>Dashboard</h2>
        <form action="{% url 'logout' %}" method="POST">
            {% csrf_token %}
            <button type="submit">Log Out</button>
        </form>
    </div>

    <div class="main">
        <h1>Welcome User!</h1>
        <p>This is your dashboard.</p>
        
        <div class="calendar-box">
            <div class="calendar-header">
                <h1 class="month-year" id="monthYear"></h1>
            </div>
            <div class="calendar-container">
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
        </div>
        
    </div>

    <script>
        const calendarGrid = document.getElementById("calendarGrid");
        const monthYear = document.getElementById("monthYear");

        const now = new Date();
        const currentDate = now.getDate();
        // const currentDay = now.getDay(); // 0 = Sunday
        const currentHour = now.getHours();

        const monthNames = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];

        // show current month & year
        monthYear.textContent = `${monthNames[now.getMonth()]} ${now.getFullYear()}`;

        // const daysOfWeek = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
        const hours = Array.from({ length: 24 }, (_, i) => {
            const hour = i % 12 || 12;
            const ampm = i < 12 ? "AM" : "PM";
            return `${hour} ${ampm}`;
        });

        // create header row, the mondays, tuesdays etc.
        const headerRow = document.createElement("div");
            headerRow.className = "header-row";
            headerRow.innerHTML = `<div class="timecol-corner"></div>` +
            Array.from({ length: daysInMonth }, (_, i) => {
                const day = i + 1;
                const dayName = new Date(now.getFullYear(), now.getMonth(), day)
                    .toLocaleString('default', { weekday: 'short' });
                return `
                    <div class="day-header ${day === currentDate ? 'current-daycol' : ''}">
                        <div>${dayName}&nbsp;</div>
                        <div><b>${day}</b></div>
                    </div>
                `;
            }).join("");
        calendarGrid.appendChild(headerRow);

        // create hour rows
        hours.forEach((h, hourIndex) => {
            const row = document.createElement("div");
            row.className = "hour-row";

            const timeCell = document.createElement("div");
            timeCell.className = "time-col";
            timeCell.textContent = h;
            row.appendChild(timeCell);

            // daysOfWeek.forEach((_, dayIndex) => {
            //     const cell = document.createElement("div");
            //     cell.className = "cell";

            //     if (dayIndex === currentDay && hourIndex === currentHour) {
            //         cell.classList.add("current-time");
            //     }

            //     row.appendChild(cell);
            // });

            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement("div");
                cell.className = "cell";

                // highlight current day & hour
                if (day === currentDate) {
                    cell.classList.add("current-day");
                }


                if (day === currentDate && hourIndex === currentHour) {
                    cell.classList.add("current-time");
                }

                row.appendChild(cell);
            }

            calendarGrid.appendChild(row);
        });
    </script>
</body>
</html>
